- [x] ++
- [x] --



> github 链接 https://github.com/vincent-vinf/microc

项目自评表

为了方便测试，编写了一个简单的makefile

```makefile
FILENAME=ex_prime3.c
arg=8
run: clean
	dotnet run --project interpc.fsproj example/$(FILENAME) $(arg)

debug: clean
	dotnet run --project interpc.fsproj -g example/$(FILENAME) $(arg)

clean:
	dotnet clean interpc.fsproj
```

运行解释器

```bash
# 直接运行
make
# 以调试模式运行
make debug
# 添加参数
make debug arg=8
```



### 效果测试

#### 自增自减

```c
void main(int n) {
    ++n;
    print n;
    n++;
    print n;
    --n;
    print n;
    n--;
    print n;
}
```

token和抽象语法树

![image-20220605103316022](assets/image-20220605103316022.png)

运行结果

![image-20220605103327059](assets/image-20220605103327059.png)

#### 三目运算符

```c
void main(int n) {
    int x;
    x = n > 10 ? n : 10;
    print x;
}
```

![image-20220605110745760](assets/image-20220605110745760.png)

![image-20220605110803061](assets/image-20220605110803061.png)

#### go for循环

在go语言当中，for有3种形式

```go
for {}
for x < 10 {}
for i := 0; i < 10; i++ {}
```

测试代码

```c
void main(int n) {
    int i;
    i = 0;
    for i < n {
        print i;
        i = i + 1;
    }
    println;
    int j;
    for j=0; j<n; j++{
        print j;
    }
}
```

![image-20220605171045527](assets/image-20220605171045527.png)

![image-20220605171059579](assets/image-20220605171059579.png)

#### 数组下标越界检查

```c
void main(){
    int arr[2];
    arr[0] = 1;
    arr[1] = 2;
    print arr[0];
    print arr[1];
    print arr[2];
}
```

![image-20220605154145611](assets/image-20220605154145611.png)

![image-20220605154230087](assets/image-20220605154230087.png)

#### go for range

```c
void main() {
    int s[8];
    int j;
    // 用普通的for赋值
    for (j = 0; j < 8; j++){
        s[j] = j*2;
        print s[j];
    }
    int x;
    int y;
    for x,y = range s {
        print x;
        print y;
        println;
    }
}
```

![image-20220605165947208](assets/image-20220605165947208.png)

![image-20220605170008884](assets/image-20220605170008884.png)

### 技术要点说明

#### go for循环

Clex词法定义

![image-20220605134912362](assets/image-20220605134912362.png)

定义2种抽象语法

![image-20220605135023650](assets/image-20220605135023650.png)

加入token和语法

![image-20220605171148420](assets/image-20220605171148420.png)

在解释器中定义两种for循环

![image-20220605135340756](assets/image-20220605135340756.png)



#### 下标越界检查 & go for range

在range遍历数组时，需要知道数组长度。所以先在store中加入一个位置存放length，并且使用这个length来对数组下标做检查。

在allocate中额外存一个长度

![image-20220605171758858](assets/image-20220605171758858.png)

在access中对下标进行检查

![image-20220605171719578](assets/image-20220605171719578.png)

在go语言当中for range循环可以将list的下标赋值给k，对应的内容赋值给v并且自动遍历整个数组

```go
var k, v int
list := []int{1, 2, 3}
for k, v = range list {
    print(k, v)
}
```

加入关键字

![image-20220605171853611](assets/image-20220605171853611.png)

加入token和语法定义

![image-20220605171942778](assets/image-20220605171942778.png)

定义ForRange

![image-20220605171910642](assets/image-20220605171910642.png)

实现ForRange

![image-20220605171429906](assets/image-20220605171429906.png)

